---
import AppShell from "../layouts/AppShell.astro";
import { AvButton, AvCard, AvContainer, AvPageHeader } from "@ansiversa/components";
---

<AppShell title="Templates" description="Pick a starting point for your resume.">
  <section class="av-page av-page--content" x-data x-init="$store.resumeBuilder.initTemplatesPage()">
    <div x-show="$store.resumeBuilder.isLoading" class="av-loading-bar"></div>

    <AvPageHeader
      title="Templates"
      description="Switch layouts anytime. Each template is optimized for clarity and ATS-friendly formatting."
      primaryAction={{ label: "New resume", href: '/resume/new', variant: 'primary' }}
    />

    <AvContainer>
      <div class="av-template-grid" x-show="$store.resumeBuilder.templates.length > 0">
        <template x-for="template in $store.resumeBuilder.templates" :key="template.id">
          <AvCard className="av-template-card">
            <div class="av-template-card__header">
              <div>
                <p class="av-template-card__name" x-text="template.name"></p>
                <p class="av-template-card__slug" x-text="template.templateKey"></p>
              </div>
              <span class="av-status-pill" x-text="template.isActive ? 'Active' : 'Draft'"></span>
            </div>
            <p class="av-template-card__description" x-text="template.description"></p>
            <div class="av-template-card__actions">
              <AvButton
                href=""
                x-bind:href="`/resume/new?template=${template.templateKey}`"
                x-on:click.prevent="$store.resumeBuilder.createNewResumeFromTemplate(template.templateKey)"
              >
                Use template
              </AvButton>
              <AvButton size="sm" variant="ghost" x-on:click.prevent="$store.resumeBuilder.changeTemplate(template.templateKey || template.id)">
                Preview
              </AvButton>
            </div>
          </AvCard>
        </template>
      </div>
    </AvContainer>
  </section>

  <style>
    .av-loading-bar {
      height: 4px;
      width: 100%;
      background: linear-gradient(90deg, #22d3ee, #6366f1);
      animation: shimmer 1.6s linear infinite;
      margin-bottom: 1rem;
    }

    @keyframes shimmer {
      0% {
        background-position: 0 0;
      }
      100% {
        background-position: 200% 0;
      }
    }

    .av-template-grid {
      display: grid;
      gap: 1rem;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
    }

    .av-template-card__header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 0.5rem;
      margin-bottom: 0.35rem;
    }

    .av-template-card__name {
      font-weight: 700;
    }

    .av-template-card__slug {
      font-size: 0.9rem;
      color: var(--av-fg-muted, #94a3b8);
    }

    .av-template-card__description {
      color: var(--av-fg, #e2e8f0);
      margin-bottom: 0.75rem;
      min-height: 48px;
    }

    .av-template-card__actions {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
    }

    .av-status-pill {
      padding: 0.25rem 0.6rem;
      border-radius: 999px;
      background: rgba(148, 163, 184, 0.15);
      color: var(--av-fg, #e2e8f0);
      font-size: 0.85rem;
    }
  </style>
</AppShell>
