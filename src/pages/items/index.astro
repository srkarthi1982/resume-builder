---
import {
  AvCard,
  AvBreadcrumb,
  AvContainer,
  AvEmptyState,
} from "@ansiversa/components";
import { actions } from "astro:actions";
import AppShell from "../../layouts/AppShell.astro";
import type { ExampleItemDTO } from "../../modules/example-items/types";

const title = "Example Items – Resume Builder";
const description = "View your example items.";

const listResult = await Astro.callAction(actions.exampleItems.fetchMyItems, {
  includeArchived: true,
  limit: 50,
});

const data = (listResult as any)?.data ?? (listResult as any) ?? {};
const items = (data?.items ?? []) as ExampleItemDTO[];

const total = items.length;
---

<AppShell title={title} description={description}>
  <section class="av-faq-public__crumb">
    <AvContainer>
      <AvBreadcrumb
        items={[
          { label: "Home", href: "/" },
          { label: "Items" },
        ]}
      />
    </AvContainer>
  </section>
  <section class="av-section">
    <AvContainer>
      <div class="av-auth-stack-lg">
        <AvCard className="av-auth-stack-md">
          <div class="av-auth-stack-sm">
            <div>
              <p class="av-kicker">Example Module</p>
              <h1 class="av-section-title">Your items</h1>
              <p class="av-text-soft">
                This page is read-only in the baseline. Manage items from the admin panel.
              </p>
            </div>
          </div>
        </AvCard>

        <AvCard variant="soft" className="av-auth-stack-md">
          <div class="av-row-between">
            <h2 class="av-card-heading">Recent items</h2>
            <p class="av-text-soft">{total} total</p>
          </div>

          {total === 0 ? (
            <AvEmptyState
              title="No items yet"
              description="Items created in admin will appear here."
            />
          ) : (
            <div class="av-auth-stack-sm">
              {items.map((item) => (
                <div class="av-card av-card-soft av-auth-stack-xs">
                  <div class="av-row-between">
                    <div>
                      <h3 class="av-card-heading">{item.title}</h3>
                      <p class="av-text-soft">{item.content || "No notes"}</p>
                    </div>
                  </div>
                  <p class="av-text-soft">
                    {item.updatedAt || item.createdAt
                      ? `Updated ${new Date(item.updatedAt || item.createdAt || "").toLocaleString()}`
                      : "Updated —"}
                  </p>
                </div>
              ))}
            </div>
          )}
        </AvCard>
      </div>
    </AvContainer>
  </section>
</AppShell>
