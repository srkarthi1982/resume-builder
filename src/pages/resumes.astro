---
import AppShell from "../layouts/AppShell.astro";
import { AvButton, AvCard, AvContainer, AvPageHeader, AvEmptyState, AvBreadcrumb } from "@ansiversa/components";
---

<AppShell title="Resumes" description="Manage all of your Ansiversa resumes in one place.">
  <section
    class="av-page av-page--content"
    x-data
    x-init="$store.resumeBuilder.initResumesPage()"
    x-cloak
  >
    <div x-show="$store.resumeBuilder.isLoading" class="av-loading-bar"></div>
    <AvContainer>
      <AvBreadcrumb items={[
        { label: "Apps", href: "https://ansiversa.com/apps" }, 
        { label: "Resumes", href: "/resumes" }
      ]} />
      <AvPageHeader
          title="Your resumes"
          description="Pick up where you left off, duplicate previous versions, or start a new draft."
          primaryAction={{
            label: "New resume",
            href: "/resume/new",
            variant: "primary",
          }}
        />
      <div
        x-show="!$store.resumeBuilder.isLoading && $store.resumeBuilder.error"
        class="av-alert av-alert--danger"
        x-text="$store.resumeBuilder.error"
      ></div>

      <!-- Empty state (only after loading finishes) -->
      <template
        x-if="!$store.resumeBuilder.isLoading && !$store.resumeBuilder.error && $store.resumeBuilder.resumes.length === 0"
      >
        <div class="av-stack">
          <AvEmptyState title="No resumes yet" description="Create your first resume in minutes.">
            <AvButton slot="actions" href="/resume/new">Create resume</AvButton>
          </AvEmptyState>
        </div>
      </template>

      <!-- Cards -->
      <div class="av-stack"
        x-show="!$store.resumeBuilder.isLoading && $store.resumeBuilder.resumes.length > 0"
      >
        <template x-for="resume in $store.resumeBuilder.resumes" :key="resume.id">
          <AvCard className="av-resume-card">
            <div class="av-resume-card__body">
              <div class="av-resume-card__header">
                <h3 class="av-resume-card__title" x-text="resume.title || 'Untitled resume'"></h3>

                <div class="av-resume-card__badges">
                  <template x-if="resume.isPrimary">
                    <span class="av-status-pill av-status-pill--primary">Primary</span>
                  </template>
                  <span
                    class="av-status-pill"
                    x-text="resume.templateKey ? `Template: ${resume.templateKey}` : 'Draft'"
                  ></span>
                </div>
              </div>

              <p class="av-resume-card__meta">
                <span x-text="resume.targetRole || 'No target role'"></span>
                <template x-if="resume.targetCompany">
                  <span>
                    <span> Â· </span>
                    <span x-text="resume.targetCompany"></span>
                  </span>
                </template>
              </p>

              <p
                class="av-resume-card__updated"
                x-text="resume.updatedLabel ? `Updated ${resume.updatedLabel}` : (resume.updatedAt ? `Updated ${resume.updatedAt}` : '')"
              ></p>
            </div>

            <div class="av-resume-card__actions">
              <a class="av-btn-primary av-btn-sm" x-bind:href="`/resume/${resume.id}`">Edit</a>

              <AvButton size="sm" variant="ghost" x-on:click.prevent="$store.resumeBuilder.duplicateResume(resume.id)">
                Duplicate
              </AvButton>

              <template x-if="!resume.isPrimary">
                <AvButton
                  size="sm"
                  variant="ghost"
                  x-on:click.prevent="$store.resumeBuilder.setPrimaryResume(resume.id)"
                >
                  Set primary
                </AvButton>
              </template>

              <AvButton size="sm" variant="ghost" disabled title="Coming soon">
                Download PDF
              </AvButton>

              <AvButton
                size="sm"
                variant="ghost"
                color="danger"
                x-on:click.prevent="$store.resumeBuilder.deleteResume(resume.id)"
              >
                Delete
              </AvButton>
            </div>
          </AvCard>
        </template>
      </div>
    </AvContainer>
  </section>
  <style>
    .av-resume-card__body {
      display: flex;
      flex-direction: column;
      gap: 0.35rem;
    }
    .av-resume-card__header {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      gap: 0.75rem;
    }
    .av-resume-card__badges {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      flex-wrap: wrap;
      justify-content: flex-end;
    }
    .av-resume-card__title {
      font-size: 1rem;
      font-weight: 600;
      line-height: 1.2;
    }
    .av-resume-card__meta {
      color: var(--av-fg-muted, #94a3b8);
      font-size: 0.9rem;
      display: flex;
      gap: 0.25rem;
      align-items: center;
      flex-wrap: wrap;
    }
    .av-resume-card__updated {
      font-size: 0.85rem;
      color: var(--av-fg-soft, #cbd5e1);
    }
    .av-resume-card__actions {
      margin-top: 0.75rem;
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
    }
  </style>
</AppShell>
